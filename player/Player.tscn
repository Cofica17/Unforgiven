[gd_scene load_steps=45 format=3 uid="uid://c0vnqt6uyxaoa"]

[ext_resource type="Script" path="res://player/Player.gd" id="1"]
[ext_resource type="PackedScene" uid="uid://cctfhhhrvnnyb" path="res://player/ControllableCamera.tscn" id="2"]
[ext_resource type="PackedScene" uid="uid://cvxcmq4sosvbr" path="res://scenes/combat_pack.tscn" id="2_oemi3"]
[ext_resource type="PackedScene" uid="uid://e2bccij4j7ud" path="res://player/Controls.tscn" id="3"]
[ext_resource type="Script" path="res://scripts/StateMachine.gd" id="4"]
[ext_resource type="Script" path="res://player/states/Stopped.gd" id="5"]
[ext_resource type="Script" path="res://player/states/Running.gd" id="6"]
[ext_resource type="Script" path="res://player/states/Jumping.gd" id="7"]
[ext_resource type="Script" path="res://player/states/Dashing.gd" id="8"]
[ext_resource type="Script" path="res://player/states/OnGround.gd" id="9"]
[ext_resource type="Script" path="res://player/states/InAir.gd" id="10"]
[ext_resource type="Script" path="res://player/states/Falling.gd" id="11"]
[ext_resource type="Script" path="res://player/states/PrimaryAttack.gd" id="11_dt8j7"]
[ext_resource type="Script" path="res://player/states/Crouching.gd" id="12"]

[sub_resource type="AnimationNodeAnimation" id="AnimationNodeAnimation_42fik"]
animation = &"unarmed-jump-up"

[sub_resource type="AnimationNodeAnimation" id="AnimationNodeAnimation_0se50"]
animation = &"Sword_Attack_1"

[sub_resource type="AnimationNodeAnimation" id="14"]
animation = &"unarmed-crouch-idle"

[sub_resource type="AnimationNodeAnimation" id="15"]
animation = &"unarmed-crouch-run"

[sub_resource type="AnimationNodeBlendSpace1D" id="30"]
blend_point_0/node = SubResource("14")
blend_point_0/pos = 0.0
blend_point_1/node = SubResource("15")
blend_point_1/pos = 1.0

[sub_resource type="AnimationNodeOneShot" id="AnimationNodeOneShot_xnsw3"]
fadein_time = 0.1
fadeout_time = 0.1

[sub_resource type="AnimationNodeAnimation" id="AnimationNodeAnimation_r7aer"]
animation = &"unarmed-jump-down"

[sub_resource type="AnimationNodeAnimation" id="AnimationNodeAnimation_xv5f5"]
animation = &"unarmed-jump"

[sub_resource type="AnimationNodeStateMachineTransition" id="AnimationNodeStateMachineTransition_rout0"]
xfade_time = 0.1

[sub_resource type="AnimationNodeStateMachineTransition" id="AnimationNodeStateMachineTransition_broob"]
switch_mode = 2
advance_mode = 2

[sub_resource type="AnimationNodeStateMachineTransition" id="AnimationNodeStateMachineTransition_njbj0"]
advance_mode = 2

[sub_resource type="AnimationNodeStateMachine" id="AnimationNodeStateMachine_d0nsn"]
states/unarmed-jump/node = SubResource("AnimationNodeAnimation_xv5f5")
states/unarmed-jump/position = Vector2(532, -4)
states/unarmed-jump-down/node = SubResource("AnimationNodeAnimation_r7aer")
states/unarmed-jump-down/position = Vector2(705, 101)
transitions = ["unarmed-jump", "unarmed-jump-down", SubResource("AnimationNodeStateMachineTransition_rout0"), "unarmed-jump-down", "End", SubResource("AnimationNodeStateMachineTransition_broob"), "Start", "unarmed-jump", SubResource("AnimationNodeStateMachineTransition_njbj0")]
graph_offset = Vector2(-30, -56)

[sub_resource type="AnimationNodeAnimation" id="32"]
animation = &"Idle"

[sub_resource type="AnimationNodeAnimation" id="33"]
animation = &"Running"

[sub_resource type="AnimationNodeBlendSpace1D" id="34"]
blend_point_0/node = SubResource("32")
blend_point_0/pos = 0.0
blend_point_1/node = SubResource("33")
blend_point_1/pos = 1.0
min_space = 0.0

[sub_resource type="AnimationNodeTransition" id="35"]
xfade_time = 0.2
input_0/name = "on-ground"
input_0/auto_advance = false
input_0/reset = true
input_1/name = "in-air"
input_1/auto_advance = false
input_1/reset = true
input_2/name = "crouching"
input_2/auto_advance = false
input_2/reset = true
input_3/name = "swimming"
input_3/auto_advance = false
input_3/reset = true
input_4/name = "surging"
input_4/auto_advance = false
input_4/reset = true
input_5/name = "state 5"
input_5/auto_advance = true
input_5/reset = true

[sub_resource type="AnimationNodeAnimation" id="48"]
animation = &"unarmed-surge-charge"

[sub_resource type="AnimationNodeAnimation" id="49"]
animation = &"unarmed-surge-release"

[sub_resource type="AnimationNodeBlendSpace1D" id="47"]
blend_point_0/node = SubResource("48")
blend_point_0/pos = 0.0
blend_point_1/node = SubResource("49")
blend_point_1/pos = 0.3

[sub_resource type="AnimationNodeAnimation" id="45"]
animation = &"unarmed-swim-idle"

[sub_resource type="AnimationNodeAnimation" id="46"]
animation = &"unarmed-swim"

[sub_resource type="AnimationNodeBlendSpace1D" id="44"]
blend_point_0/node = SubResource("45")
blend_point_0/pos = 0.0
blend_point_1/node = SubResource("46")
blend_point_1/pos = 1.0

[sub_resource type="AnimationNodeBlendTree" id="36"]
nodes/Animation/node = SubResource("AnimationNodeAnimation_0se50")
nodes/Animation/position = Vector2(-180, 560)
"nodes/Animation 2/node" = SubResource("AnimationNodeAnimation_42fik")
"nodes/Animation 2/position" = Vector2(-800, 200)
nodes/Crouching/node = SubResource("30")
nodes/Crouching/position = Vector2(-360, 260)
nodes/Jump/node = SubResource("AnimationNodeOneShot_xnsw3")
nodes/Jump/position = Vector2(-560, 80)
nodes/Jumping/node = SubResource("AnimationNodeStateMachine_d0nsn")
nodes/Jumping/position = Vector2(-740, 60)
nodes/OnGround/node = SubResource("34")
nodes/OnGround/position = Vector2(-480, -80)
nodes/RootState/node = SubResource("35")
nodes/RootState/position = Vector2(-20, 140)
nodes/Surging/node = SubResource("47")
nodes/Surging/position = Vector2(-360, 540)
nodes/Swimming/node = SubResource("44")
nodes/Swimming/position = Vector2(-360, 400)
nodes/output/position = Vector2(540, 140)
node_connections = [&"output", 0, &"RootState", &"Jump", 0, &"Jumping", &"Jump", 1, &"Animation 2", &"RootState", 0, &"OnGround", &"RootState", 1, &"Jump", &"RootState", 2, &"Crouching", &"RootState", 3, &"Swimming", &"RootState", 4, &"Surging", &"RootState", 5, &"Animation"]

[sub_resource type="AnimationNodeStateMachinePlayback" id="AnimationNodeStateMachinePlayback_8horh"]

[sub_resource type="StandardMaterial3D" id="16"]
transparency = 1
blend_mode = 1
cull_mode = 2
shading_mode = 0
vertex_color_use_as_albedo = true

[sub_resource type="Gradient" id="19"]
offsets = PackedFloat32Array(0.038, 0.483, 0.908)
colors = PackedColorArray(1, 0.654902, 0, 1, 1, 0.945098, 0.152941, 1, 1, 0.988235, 0.827451, 0)

[sub_resource type="GradientTexture2D" id="20"]
gradient = SubResource("19")

[sub_resource type="ParticleProcessMaterial" id="17"]
emission_shape = 3
emission_box_extents = Vector3(0.281, 0.524, 0)
direction = Vector3(0, 0, 1)
spread = 0.0
gravity = Vector3(0, 0, 0)
color_ramp = SubResource("20")

[sub_resource type="BoxMesh" id="18"]
size = Vector3(0.04, 0.04, 2)

[sub_resource type="CapsuleShape3D" id="37"]
radius = 0.3
height = 1.8

[node name="Player" type="CharacterBody3D" groups=["player"]]
script = ExtResource("1")

[node name="Skin" type="Node3D" parent="."]

[node name="CombatPack" parent="Skin" instance=ExtResource("2_oemi3")]

[node name="Skeleton3D" parent="Skin/CombatPack/main_character/Armature" index="0"]
bones/0/position = Vector3(0.286729, 1.41755, -79.0376)
bones/0/rotation = Quaternion(-0.711675, -0.0264638, -0.0431026, 0.700686)
bones/1/position = Vector3(-0.000484042, 6.97961, 1.32699)
bones/1/rotation = Quaternion(-0.102649, -0.014465, 0.0260196, 0.994272)
bones/2/position = Vector3(3.22707e-11, 9.15704, 2.22027e-06)
bones/2/rotation = Quaternion(0.0115402, -0.00998613, 0.0536977, 0.998441)
bones/3/position = Vector3(1.07219e-07, 9.22586, -2.12043e-06)
bones/3/rotation = Quaternion(0.10305, 0.00093551, 0.0486096, 0.993487)
bones/4/position = Vector3(0.0159639, 10.3639, -2.12106)
bones/4/rotation = Quaternion(0.00841685, -0.00237195, -0.0187319, 0.999786)
bones/5/position = Vector3(7.41915e-09, 5.05646, 0.719562)
bones/5/rotation = Quaternion(0.0156232, 0.00631616, -0.069579, 0.997434)
bones/7/position = Vector3(3.6, 8.43649, -2.0359)
bones/7/rotation = Quaternion(-0.646746, -0.391575, 0.479878, -0.445091)
bones/8/position = Vector3(2.26951e-06, 7.86576, -2.69965e-07)
bones/8/rotation = Quaternion(0.585336, -0.0293594, -0.0722652, 0.80703)
bones/9/position = Vector3(-5.6373e-07, 18.982, 2.16025e-06)
bones/9/rotation = Quaternion(0.00530837, -0.000908694, 0.167616, 0.985838)
bones/10/position = Vector3(-1.05782e-06, 18.4362, -6.04605e-07)
bones/10/rotation = Quaternion(0.0917841, -0.234875, 0.0244007, 0.967375)
bones/11/position = Vector3(-1.42275, 3.08625, 1.28371)
bones/11/rotation = Quaternion(0.153874, 0.245462, 0.223705, 0.930606)
bones/12/position = Vector3(4.80363e-07, 2.92917, 1.60955e-06)
bones/12/rotation = Quaternion(-0.0143856, -0.134117, -0.268353, 0.95383)
bones/13/position = Vector3(-5.00679e-06, 2.65227, 2.57492e-05)
bones/13/rotation = Quaternion(-0.00143193, -0.0238942, -0.0736949, 0.996994)
bones/14/position = Vector3(-1.10269e-06, 2.70566, -4.55975e-06)
bones/15/position = Vector3(-1.91078, 7.46399, -1.01298)
bones/15/rotation = Quaternion(0.132939, -0.00103751, -0.0752104, 0.988266)
bones/16/position = Vector3(4.77246e-07, 3.3, -4.00469e-07)
bones/16/rotation = Quaternion(0.187747, -0.00116076, -0.0423988, 0.981301)
bones/17/position = Vector3(-3.20739e-08, 2, -4.47406e-06)
bones/17/rotation = Quaternion(0.100014, -0.000352432, -0.0170633, 0.99484)
bones/18/position = Vector3(4.3001e-07, 2.33434, 2.48286e-06)
bones/19/position = Vector3(-0.21969, 7.48592, -1.40666)
bones/19/rotation = Quaternion(0.22246, -0.00447008, -0.129447, 0.9663)
bones/20/position = Vector3(5.46238e-07, 3.6, -3.02494e-06)
bones/20/rotation = Quaternion(0.29452, -0.00233582, -0.0627658, 0.953579)
bones/21/position = Vector3(1.82121e-07, 2.29999, -4.62857e-07)
bones/21/rotation = Quaternion(0.117538, 1.97349e-05, -0.0250297, 0.992753)
bones/22/position = Vector3(4.61616e-07, 2.75205, -9.2797e-06)
bones/23/position = Vector3(1.08288, 7.11996, -1.51837)
bones/23/rotation = Quaternion(0.331462, -0.014694, -0.199759, 0.921962)
bones/24/position = Vector3(7.49695e-07, 3.40001, 8.64426e-07)
bones/24/rotation = Quaternion(0.344111, 0.00223407, -0.0701267, 0.936304)
bones/25/position = Vector3(-9.20306e-07, 2, -6.28816e-06)
bones/25/rotation = Quaternion(0.171869, 0.00216991, -0.0330534, 0.984563)
bones/26/position = Vector3(1.55599e-06, 2.28072, 2.4438e-06)
bones/27/position = Vector3(2.43135, 6.57644, -1.18488)
bones/27/rotation = Quaternion(0.39407, -0.0156839, -0.253414, 0.883315)
bones/28/position = Vector3(-9.08576e-07, 3.4, -1.04308e-06)
bones/28/rotation = Quaternion(0.387971, -0.00279074, -0.0739044, 0.9187)
bones/29/position = Vector3(1.63676e-06, 1.70001, 1.26362e-05)
bones/29/rotation = Quaternion(0.181152, -0.000270127, -0.0426479, 0.98253)
bones/30/position = Vector3(-6.50215e-07, 1.65955, 1.57949e-06)
bones/31/position = Vector3(-3.6, 8.43614, -2.0359)
bones/31/rotation = Quaternion(0.602159, -0.436768, 0.534594, 0.401058)
bones/32/position = Vector3(1.55411e-06, 7.86572, 9.57213e-06)
bones/32/rotation = Quaternion(0.462641, 0.0280601, 0.0141927, 0.885988)
bones/33/position = Vector3(2.16021e-07, 18.982, -4.89736e-06)
bones/33/rotation = Quaternion(0.0052871, 0.00105897, -0.194845, 0.980819)
bones/34/position = Vector3(1.67734e-06, 18.4362, -2.90908e-06)
bones/34/rotation = Quaternion(0.0960798, 0.109523, 0.0575302, 0.987656)
bones/35/position = Vector3(1.42275, 3.0862, 1.284)
bones/35/rotation = Quaternion(0.153692, -0.242353, -0.223461, 0.931509)
bones/36/position = Vector3(-1.17027e-06, 2.92916, 1.10834e-05)
bones/36/rotation = Quaternion(-0.0193209, 0.134084, 0.268103, 0.953818)
bones/37/position = Vector3(-9.61128e-08, 2.65238, 4.73672e-07)
bones/37/rotation = Quaternion(0.003418, 0.0245911, 0.065706, 0.99753)
bones/38/position = Vector3(-2.23519e-06, 2.70563, -4.36156e-05)
bones/39/position = Vector3(1.91078, 7.4639, -1.01299)
bones/39/rotation = Quaternion(0.133021, 0.00102981, 0.0752709, 0.98825)
bones/40/position = Vector3(5.37335e-07, 3.30009, 1.30974e-06)
bones/40/rotation = Quaternion(0.187454, 0.00117199, 0.042552, 0.981351)
bones/41/position = Vector3(3.07737e-07, 2.00001, -1.5988e-06)
bones/41/rotation = Quaternion(0.132281, 0.00202998, 0.0144951, 0.991104)
bones/42/position = Vector3(-1.66576e-07, 2.33425, 5.92875e-06)
bones/43/position = Vector3(0.451775, 7.50449, -1.40599)
bones/43/rotation = Quaternion(0.222019, 0.00977796, 0.152694, 0.962963)
bones/44/position = Vector3(-2.6757e-08, 3.59989, -4.24259e-07)
bones/44/rotation = Quaternion(0.294536, 0.00232973, 0.0630903, 0.953553)
bones/45/position = Vector3(-1.33161e-06, 2.30003, 4.10559e-06)
bones/45/rotation = Quaternion(0.148756, 0.000262552, 0.0297293, 0.988427)
bones/46/position = Vector3(-4.52323e-07, 2.75213, 3.35276e-06)
bones/47/position = Vector3(-1.08288, 7.1199, -1.51799)
bones/47/rotation = Quaternion(0.331154, 0.0146047, 0.200342, 0.921947)
bones/48/position = Vector3(2.15743e-07, 3.4, -3.95636e-06)
bones/48/rotation = Quaternion(0.343876, -0.00222938, 0.0710212, 0.936323)
bones/49/position = Vector3(-6.2556e-07, 1.99994, -4.01477e-06)
bones/49/rotation = Quaternion(0.160533, 0.00124205, 0.0152484, 0.986912)
bones/50/position = Vector3(8.66347e-07, 2.28075, -1.91758e-06)
bones/51/position = Vector3(-2.43135, 6.5764, -1.184)
bones/51/rotation = Quaternion(0.392565, 0.0288054, 0.283957, 0.874318)
bones/52/position = Vector3(9.37594e-07, 3.40001, -7.0036e-06)
bones/52/rotation = Quaternion(0.38775, 0.00278961, 0.0750951, 0.918696)
bones/53/position = Vector3(-1.69823e-06, 1.69999, 2.83174e-06)
bones/53/rotation = Quaternion(0.197222, 0.00682298, 0.0203132, 0.980125)
bones/54/position = Vector3(-3.65363e-06, 1.65958, -4.35114e-06)
bones/55/position = Vector3(-3.03243, 5.32633, 0.515521)
bones/56/position = Vector3(-6.61959, -3.92206, -0.447163)
bones/56/rotation = Quaternion(-0.0430163, 0.0243982, 0.994173, -0.09578)
bones/57/position = Vector3(-3.00672e-07, 33.3812, 2.71407e-07)
bones/57/rotation = Quaternion(-0.156574, 0.0433644, 0.0255027, 0.986384)
bones/58/position = Vector3(8.72823e-07, 34.8929, 1.98228e-07)
bones/58/rotation = Quaternion(0.436505, -0.0077729, -0.0797107, 0.89613)
bones/59/position = Vector3(1.03679e-06, 11.5, 2.88337e-06)
bones/59/rotation = Quaternion(0.447635, 0.00780935, 0.0066303, 0.894158)
bones/61/position = Vector3(6.62095, -3.92205, -0.447165)
bones/61/rotation = Quaternion(0.112522, 0.176425, 0.969231, -0.129632)
bones/62/rotation = Quaternion(-0.267861, -0.0774585, 0.0353393, 0.959688)
bones/63/rotation = Quaternion(0.384603, -0.0681958, -0.0748566, 0.917511)
bones/64/position = Vector3(1.66474e-07, 11.5, 1.58697e-06)
bones/64/rotation = Quaternion(0.446756, -0.00777733, -0.00662362, 0.894598)

[node name="BoneAttachment3D" parent="Skin/CombatPack/main_character/Armature/Skeleton3D" index="1"]
transform = Transform3D(-0.156842, 0.0538236, 0.986156, 0.250014, 0.968154, -0.0130779, -0.955455, 0.244501, -0.165304, -14.8708, -0.621557, -66.3452)

[node name="AnimationTree" type="AnimationTree" parent="Skin"]
tree_root = SubResource("36")
anim_player = NodePath("../CombatPack/main_character/AnimationPlayer")
active = true
parameters/Crouching/blend_position = 0.0
parameters/Jump/active = false
parameters/Jump/request = 0
parameters/Jumping/playback = SubResource("AnimationNodeStateMachinePlayback_8horh")
parameters/OnGround/blend_position = 0.0
parameters/RootState/current_state = "on-ground"
parameters/RootState/transition_request = ""
parameters/RootState/current_index = 0
parameters/Surging/blend_position = 0.0
parameters/Swimming/blend_position = 0.0

[node name="VfxDash" type="GPUParticles3D" parent="Skin"]
transform = Transform3D(1, 0, 0, 0, 1, 0, 0, 0, 1, 0, 0.984, 1.12412)
material_override = SubResource("16")
emitting = false
amount = 16
lifetime = 0.3
one_shot = true
explosiveness = 1.0
randomness = 0.34
visibility_aabb = AABB(-1.39, -2.508, -3.479, 2.781, 5.015, 6.958)
local_coords = true
process_material = SubResource("17")
draw_pass_1 = SubResource("18")

[node name="CollisionShape3D" type="CollisionShape3D" parent="."]
transform = Transform3D(1, 0, 0, 0, 1, 0, 0, 0, 1, 0, 0.9, -4.37114e-09)
shape = SubResource("37")

[node name="CamRoot" type="Node3D" parent="."]
transform = Transform3D(1, 0, 0, 0, 1, 0, 0, 0, 1, 0, 2.1, 0)

[node name="ControllableCamera" parent="CamRoot" instance=ExtResource("2")]

[node name="Controls" parent="." instance=ExtResource("3")]

[node name="Movement" type="Node" parent="."]
script = ExtResource("4")
initial_state = NodePath("OnGround")

[node name="Crouching" type="Node" parent="Movement"]
script = ExtResource("12")

[node name="Stopped" type="Node" parent="Movement/Crouching"]
script = ExtResource("5")

[node name="Moving" type="Node" parent="Movement/Crouching"]
script = ExtResource("6")
move_speed = 4.0
sprint_speed = 4.0
turn_speed = 8.0
acceleration = 30.0
cam_follow_speed = 4.0

[node name="OnGround" type="Node" parent="Movement"]
script = ExtResource("9")

[node name="Stopped" type="Node" parent="Movement/OnGround"]
script = ExtResource("5")

[node name="Running" type="Node" parent="Movement/OnGround"]
script = ExtResource("6")
move_speed = 5.0

[node name="Dashing" type="Node" parent="Movement/OnGround"]
script = ExtResource("8")

[node name="PrimaryAttack" type="Node" parent="Movement/OnGround"]
script = ExtResource("11_dt8j7")

[node name="InAir" type="Node" parent="Movement"]
script = ExtResource("10")

[node name="Falling" type="Node" parent="Movement/InAir"]
script = ExtResource("11")

[node name="Jumping" type="Node" parent="Movement/InAir"]
script = ExtResource("7")

[node name="Dashing" type="Node" parent="Movement/InAir"]
script = ExtResource("8")
dash_power = 180.0

[node name="DashTimer" type="Timer" parent="."]
one_shot = true

[connection signal="animation_finished" from="Skin/AnimationTree" to="Movement/OnGround/PrimaryAttack" method="_on_animation_tree_animation_finished"]

[editable path="Skin/CombatPack"]
